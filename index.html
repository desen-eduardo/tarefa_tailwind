<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailwind CSS</title>
    <link rel="stylesheet" href="./src/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="flex items-center w-full my-8 flex-col">
        <div class="w-4xl border border-green-500 rounded-sm">
            <div class="p-2 bg-green-950 text-white flex justify-center">
                Lista de Tarefa
            </div>
            <div class="py-4 px-2">
                <form  method="post" id="formularioTarefa" autocomplete="off">
                    <div>
                        <label for="tarefa" class="text-gray-600 text-lg">Tarefas:</label>
                        <input type="text" name="tarefa" placeholder="Digite sua tarefa"
                         id="tarefa" class="border-b border-green-700 w-full outline-0 text-green-700">
                        <input type="hidden" name="completed">
                        <input type="hidden" name="uuid">
                    </div>
                    <div>
                        <span class="text-red-400 my-0.5 hidden" id="error">Preencha a tarefa. Campo obrigat√≥rio</span>
                    </div>
                    <div class="flex justify-end my-4">
                        <button type="submit" class="p-2 border border-white rounded-md text-center
                         bg-green-800 hover:bg-green-600 cursor-pointer text-white">Adicionar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="w-4xl my-8">
            <div class="flex w-full gap-3 flex-wrap box-border" id="listagem">
            </div>
        </div>
    </div>

    <script>
        const formularioTarefa = document.querySelector('#formularioTarefa');
        const listagem = [];
        let tarefa = document.getElementsByName('tarefa')[0];
        let uuid = document.getElementsByName('uuid')[0];
        let completed = document.getElementsByName('completed')[0];
        let error = document.querySelector('#error');


        formularioTarefa.addEventListener('submit',(event)=>{
            event.preventDefault();

            if (!tarefa.value) {
                error.style.display = 'block';
                return;
            }

            if (uuid.value) {
                updatedTarefa(uuid.value,tarefa.value,completed.value);
                return;
            }

            listagem.push({
                uuid:Date.now(),
                name:tarefa.value,
                completed:false
            });

            tarefa.value = '';
            listagemTarefa();
        });

        const listagemTarefa = () => {
            let arrayListagem = document.querySelector('#listagem');
            arrayListagem.innerHTML = '';
            let html = '';
            for (items of listagem) {
                html += `<div class="w-2xs bg-gray-300 p-2 rounded-sm flex flex-row justify-between">
                    <div class="flex items-center cursor-pointer" onclick="checked(${items.uuid})">
                        ${(items.completed === true || items.completed === 'true') ? '<i class="fa-solid fa-check text-green-700 mr-1.5"></i>':''}
                        <span ${(items.completed === true || items.completed === 'true') ? ' class="line-through"':''}>${items.name}</span>
                    </div>
                    <div>
                        <i class="fa-solid fa-edit text-green-700 cursor-pointer" onclick="editaTarefa(${items.uuid})"></i>
                        <i class="fa-solid fa-trash text-red-600 cursor-pointer" onclick="removeTarefa(${items.uuid})"></i>
                    </div>
                </div>`;
            }

            arrayListagem.innerHTML = html;
        }

        tarefa.addEventListener('keyup',()=>{
            error.style.display = 'none';
        });

        const removeTarefa = (uuid)=>{
            let index = listagem.findIndex((item)=> {
                if (uuid == item.uuid) return item 
            });

            listagem.splice(index,1);
            listagemTarefa();
            checkedLista();
        }

        const editaTarefa = (id)=>{
            
            let index = listagem.findIndex((item)=> {
                if (id == item.uuid) return item 
            });
            
            uuid.value = listagem[index].uuid; 
            completed.value = listagem[index].completed
            tarefa.value = listagem[index].name
        }

        const updatedTarefa = (uuid,tarefa,completed) => {

            let index = listagem.findIndex((item)=> {
                if (uuid == item.uuid) return item 
            });

            listagem[index] = {
                uuid: uuid,
                completed: completed,
                name: tarefa
            }

            listagemTarefa();
            cleanInputs();
        } 

        const checked = (uuid)=>{
            let index = listagem.findIndex((item)=> {
                if (uuid == item.uuid) return item 
            });

            listagem[index] = {
                uuid:listagem[index].uuid,
                completed: !listagem[index].completed,
                name: listagem[index].name,
            }

            listagemTarefa();
        }

        const cleanInputs = ()=> {
            uuid.value = '';
            completed.value = '';
            tarefa.value = '';
        }

        const checkedLista = () => {
            if (listagem.length == 0) 
            document.querySelector('#listagem').innerHTML = `<div class="flex justify-center w-full"><h2 class="text-red-700">
                Sem registro encontrado</h2>
            `;
        }

        checkedLista();
    </script>
</body>
</html>